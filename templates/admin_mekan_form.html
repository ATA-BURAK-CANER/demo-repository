<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if mekan %}D√ºzenle{% else %}Yeni Mekan{% endif %} | Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            padding-top: 80px;
            min-height: 100vh;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(233, 69, 96, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(255, 193, 7, 0.05) 0%, transparent 50%);
            z-index: -1;
        }

        .navbar {
            background: rgba(15, 52, 96, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(255, 193, 7, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .navbar-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffc107 !important;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.8) !important;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            color: #ffc107 !important;
        }

        .form-container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 193, 7, 0.2);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .form-header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 193, 7, 0.2);
        }

        .form-header h1 {
            color: #ffc107;
            font-size: 2rem;
            margin: 0 0 10px;
            font-weight: 700;
        }

        .form-header p {
            color: rgba(255, 255, 255, 0.6);
            margin: 0;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            color: #ffc107;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
            font-size: 1rem;
        }

        .form-control,
        select {
            background: rgba(255, 255, 255, 0.25);
            border: 2px solid rgba(255, 193, 7, 0.4);
            color: #000;
            padding: 12px 16px;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            font-weight: 600;
        }

        .form-control:focus,
        select:focus {
            background: rgba(255, 255, 255, 0.35);
            border-color: #ffc107;
            color: #000;
            box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.25);
            outline: none;
        }

        .form-control::placeholder {
            color: rgba(0, 0, 0, 0.6);
            font-weight: 600;
        }

        select option {
            background: #f5f5f5;
            color: #000;
            font-weight: 600;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 150px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-section {
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 1px solid rgba(255, 193, 7, 0.1);
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: #ffc107;
            font-size: 1.3rem;
            font-weight: 700;
            margin: 30px 0 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 193, 7, 0.2);
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn-primary,
        .btn-secondary {
            padding: 14px 30px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #000;
            flex: 1;
            min-width: 150px;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .help-text {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-top: 8px;
        }

        .image-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 25px;
            border-radius: 10px;
            border: 2px dashed rgba(255, 193, 7, 0.2);
        }

        .image-preview {
            margin-top: 20px;
        }

        .image-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 193, 7, 0.1);
        }

        .image-name {
            color: #ffc107;
            font-weight: 600;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .btn-delete-img {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: #fff;
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-delete-img:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }

        .mekan-id-badge {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 20px;
        }

        .alert {
            border-radius: 10px;
            border: none;
            margin-bottom: 20px;
        }

        .alert-error {
            background: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('admin_dashboard') }}">üèõÔ∏è Admin Panel</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin_dashboard') }}">‚Üê Panele D√∂n</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div style="padding: 30px;">
        <div class="form-container">
            <div class="form-header">
                <h1>{% if mekan %}üìù Mekanƒ± D√ºzenle{% else %}‚ûï Yeni Mekan Ekle{% endif %}</h1>
                {% if mekan %}
                <p>ID: {{ mekan['id'] }} | {{ mekan['isim'] }}</p>
                {% else %}
                <p>Tarihi veritabanƒ±na yeni bir mekan ekleyin</p>
                {% endif %}
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" enctype="multipart/form-data">
                <!-- Temel Bilgiler -->
                <div class="form-section">
                    <h2 class="section-title">üìå Temel Bilgiler</h2>

                    <div class="form-group">
                        <label for="isim">Mekan ƒ∞smi *</label>
                        <input
                            type="text"
                            class="form-control"
                            id="isim"
                            name="isim"
                            value="{{ mekan['isim'] if mekan else '' }}"
                            placeholder="√ñrn: Topkapƒ± Sarayƒ±"
                            required
                        >
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="sehir">≈ûehir *</label>
                            <select class="form-control" id="sehir" name="sehir" required>
                                <option value="">≈ûehir Se√ßin</option>
                                {% for city in cities %}
                                <option value="{{ city }}" {% if mekan and mekan['sehir'] == city %}selected{% endif %}>
                                    {{ city }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="kategori">Kategori *</label>
                            <select class="form-control" id="kategori" name="kategori" required>
                                <option value="">Kategori Se√ßin</option>
                                {% for cat in categories %}
                                <option value="{{ cat }}" {% if mekan and mekan['kategori'] == cat %}selected{% endif %}>
                                    {{ cat }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Konum Bilgileri -->
                <div class="form-section">
                    <h2 class="section-title">üó∫Ô∏è Konum Bilgileri</h2>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="lat">Latitude (Enlem) *</label>
                            <input
                                type="number"
                                class="form-control"
                                id="lat"
                                name="lat"
                                value="{{ "%.6f" | format(mekan['lat']) if mekan else '' }}"
                                placeholder="37.614213"
                                step="0.000001"
                                required
                            >
                            <p class="help-text">Mekanƒ±n harita enlemini girin</p>
                        </div>

                        <div class="form-group">
                            <label for="lon">Longitude (Boylam) *</label>
                            <input
                                type="number"
                                class="form-control"
                                id="lon"
                                name="lon"
                                value="{{ "%.6f" | format(mekan['lon']) if mekan else '' }}"
                                placeholder="28.983086"
                                step="0.000001"
                                required
                            >
                            <p class="help-text">Mekanƒ±n harita boylamƒ±nƒ± girin</p>
                        </div>
                    </div>
                </div>

                <!-- A√ßƒ±klamalar -->
                <div class="form-section">
                    <h2 class="section-title">üìù A√ßƒ±klamalar</h2>

                    <div class="form-group">
                        <label for="kisa">Kƒ±sa A√ßƒ±klama *</label>
                        <textarea
                            class="form-control"
                            id="kisa"
                            name="kisa"
                            placeholder="Mekanƒ±n kƒ±sa a√ßƒ±klamasƒ± (bir satƒ±r)"
                            required
                        >{{ mekan['kisa'] if mekan else '' }}</textarea>
                        <p class="help-text">Mekan listesinde g√∂sterilecek kƒ±sa a√ßƒ±klama</p>
                    </div>

                    <div class="form-group">
                        <label for="uzun">Uzun A√ßƒ±klama *</label>
                        <textarea
                            class="form-control"
                            id="uzun"
                            name="uzun"
                            placeholder="Mekanƒ±n detaylƒ± a√ßƒ±klamasƒ±..."
                            required
                        >{{ mekan['uzun'] if mekan else '' }}</textarea>
                        <p class="help-text">Mekan detay sayfasƒ±nda g√∂sterilecek tam a√ßƒ±klama</p>
                    </div>
                </div>

                <!-- Varsayƒ±lan g√∂rsel alanƒ± kaldƒ±rƒ±ldƒ±: g√∂rseller artƒ±k /upload veya admin upload ile eklenir -->

                <!-- G√∂rsel Y√ºkle (Sadece D√ºzenlemede) -->
                <!-- NOTE: moved image upload/preview block below the main form to avoid nested forms -->

                <!-- Butonlar -->
                <div class="button-group">
                    <button type="submit" class="btn-primary">
                        {% if mekan %}üíæ Deƒüi≈üiklikleri Kaydet{% else %}‚ûï Mekanƒ± Ekle{% endif %}
                    </button>
                    <a href="{{ url_for('admin_dashboard') }}" style="flex: 1; min-width: 150px;">
                        <button type="button" class="btn-secondary" style="width: 100%;">‚Üê Geri D√∂n</button>
                    </a>
                </div>
            </form>

            {% if mekan %}
            <div class="form-section">
                <h2 class="section-title">üì∏ G√∂rselleri Y√∂net</h2>

                <!-- Y√ºkleme Formu -->
                <div class="image-section">
                    <h3 style="color: #ffc107; margin-bottom: 15px;">Yeni G√∂rsel Y√ºkle</h3>
                    <form method="POST" action="{{ url_for('admin_upload_image', mekan_id=mekan['id']) }}" enctype="multipart/form-data">
                        <div class="form-group">
                            <input type="file" class="form-control" id="fileInput" name="file" accept="image/*" required>
                            <p class="help-text">Desteklenen formatlar: PNG, JPG, JPEG, GIF, SVG</p>
                        </div>
                        <div style="margin-top:10px;">
                            <button type="submit" class="btn-primary">G√∂rseli Y√ºkle</button>
                        </div>
                    </form>
                </div>

                <!-- Y√ºkl√º G√∂rseller -->
                {% if images %}
                <div class="image-preview">
                    <h3 style="color: #ffc107; margin-bottom: 15px;">Y√ºkl√º G√∂rseller</h3>
                    {% for img in images %}
                    <div class="image-item">
                        <span class="image-name">{{ img.replace('images/', '') }}</span>
                        <form method="POST" action="{{ url_for('admin_delete_image', mekan_id=mekan['id'], filename=img.replace('images/', '')) }}" style="display: inline;" onsubmit="return confirm('Bu g√∂rseli silmek istediƒüinizden emin misiniz?');">
                            <button type="submit" class="btn-delete-img">üóëÔ∏è Sil</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div style="text-align: center; color: rgba(255, 255, 255, 0.5); padding: 30px 0;">
                    <p>Hen√ºz y√ºkl√º g√∂rsel yok</p>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
</body>
</html>
